<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>KMS UMKM Susu Segar â€” FINAL ADMIN EDITION</title>

<style>
/* ============================================================
    GLOBAL STYLE
============================================================ */
:root{
    --accent:#1f6feb;
    --accent2:#00b4d8;
    --muted:#6b7280;
    --white:#ffffff;
    --bg:#f5f6fa;
    --radius:12px;
    --maxw:1200px;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{
    font-family:system-ui,Arial,sans-serif;
    background:var(--bg);
    color:#222;
    line-height:1.6;
    /* Ensure body takes full screen height for the app/login */
    height: 100vh;
    overflow: hidden; 
}

/* ============================================================
    LOGIN PAGE â€” NEW DESIGN (BACKGROUND KULIT SAPI)
============================================================ */
#loginPage {
    width:100%;
    height:100vh;
    /* Ganti background dengan motif kulit sapi hitam putih */
    background:url('sapiiii.jpg'); /* Pola abstrak hitam putih */
    background-size:150px; /* Ukuran pola lebih kecil agar terlihat seperti kulit */
    background-repeat: repeat;
    background-position:center;
    display:flex;
    justify-content:center;
    align-items:center;
    backdrop-filter:blur(2px);
    z-index: 100; /* Pastikan login di atas segalanya */
    position: absolute;
    top: 0;
    left: 0;
}

.loginCard{
    width:380px;
    padding:32px;
    background:rgba(255,255,255,0.92);
    border-radius:var(--radius);
    box-shadow:0 6px 20px rgba(0,0,0,0.2);
    animation:fadeUp .6s ease;
}

@keyframes fadeUp{
    from{opacity:0; transform:translateY(20px);}
    to{opacity:1; transform:translateY(0);}
}

.loginCard h2{
    text-align:center;
    margin-bottom:18px;
    font-weight:700;
    color:#124b94;
}

.loginField{
    margin-bottom:14px;
    display:flex;
    flex-direction:column;
    gap:6px;
}

.loginField select,
.loginField input{
    padding:12px;
    border-radius:8px;
    border:1px solid #cfd6e1;
    font-size:15px;
}

.btnLogin{
    width:100%;
    padding:12px;
    background:linear-gradient(135deg,#1f6feb,#00b4d8);
    border:none;
    color:white;
    border-radius:10px;
    font-size:16px;
    font-weight:600;
    margin-top:10px;
    cursor:pointer;
    transition:.2s;
}
.btnLogin:hover{
    filter:brightness(1.1);
}

#loginError{
    margin-top:10px;
    text-align:center;
    font-size:14px;
    color:#d62828;
}

/* ============================================================
    HEADER (Di dalam #app)
============================================================ */
header{
    background:linear-gradient(90deg,#1f6feb,#00b4d8);
    padding:18px 0;
    color:white;
    box-shadow:0 2px 10px rgba(0,0,0,0.15);
}
.headerWrap{
    max-width:var(--maxw);
    margin:auto;
    padding:0 16px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}
#roleBadge{
    background:white;
    padding:6px 12px;
    border-radius:999px;
    color:#1f6feb;
    font-weight:600;
    display:none;
}

/* ============================================================
    LAYOUT GRID (Kontainer Aplikasi Utama)
============================================================ */
#app{
    /* Pastikan app mengambil seluruh ruang layar */
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
}

#appContainer{
    max-width:var(--maxw);
    margin:20px auto;
    padding:0 16px;
    display:grid;
    grid-template-columns:260px 1fr;
    gap:20px;
    flex-grow: 1; /* Biarkan konten mengisi sisa ruang */
    overflow-y: auto; /* Scroll hanya di bagian konten utama */
}
@media (max-width:850px){
    #appContainer{grid-template-columns:1fr;}
}

/* ============================================================
    SIDEBAR
============================================================ */
.sidebar{
    background:white;
    padding:18px;
    border-radius:var(--radius);
    box-shadow:0 4px 12px rgba(0,0,0,0.06);
    /* Atur agar sidebar tidak ikut scroll jika konten utama yang scroll */
    align-self: flex-start;
    position: sticky;
    top: 20px;
}
.sidebar nav{
    margin-top:10px;
    display:flex;
    flex-direction:column;
    gap:6px;
}
.sidebar nav a{
    padding:10px 12px;
    border-radius:8px;
    font-weight:600;
    cursor:pointer;
    color:#1f6feb;
    text-decoration:none;
}
.sidebar nav a.active{
    background:#e7f0ff;
}

.sidebar nav a {
    transition: 0.25s ease;
}
.sidebar nav a:hover {
    background: #dceaff;
    transform: translateX(4px);
}
.sidebar nav a.active {
    background: #e7f0ff;
    font-weight: 700;
    transform: translateX(6px);
    border-left: 4px solid var(--accent);
}

/* ============================================================
    CONTENT AREA
============================================================ */
.card{
    background:white;
    padding:20px;
    border-radius:var(--radius);
    box-shadow:0 4px 10px rgba(0,0,0,0.05);
    margin-bottom:20px;
}

.hidden{display:none;}

/* SOP COLLAPSIBLE */
.sopItem h3{
    cursor:pointer;
    color:#1f6feb;
}
.sopDetail{
    margin-top:6px;
    padding-left:14px;
    display:none;
}

/* Varian Menu Styling */
.menu-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px;
    margin-top: 15px;
}
.menu-item {
    background: var(--bg);
    border-radius: var(--radius);
    padding: 10px;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
.menu-item img {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 50%;
    margin-bottom: 8px;
    border: 3px solid var(--accent2);
}
.menu-item h4 {
    margin: 0;
    font-size: 1.1em;
    color: #124b94;
}

/* ============================================================
    ADMIN PANEL FEATURES
============================================================ */
.adminBox{
    background:#f1f7ff;
    padding:14px;
    border-left:4px solid #1f6feb;
    margin-bottom:16px;
    border-radius:8px;
}

.adminInput{
    width:100%;
    padding:10px;
    border:1px solid #cfd6e1;
    border-radius:8px;
    margin:6px 0 12px;
}

.adminBtn{
    padding:10px 14px;
    background:#1f6feb;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
    font-size:14px;
}

/* Logout */
#logoutBtn{
    margin-top:16px;
    padding:10px 14px;
    border-radius:8px;
    border:1px solid #ccc;
    background:#fafafa;
    cursor:pointer;
    font-weight:600;
    width: 100%; /* Pastikan tombol logout memenuhi lebar sidebar */
}
</style>
</head>

<body>

<div id="loginPage">
    <div class="loginCard">
        <h2>Login KMS UMKM Susu Segar</h2>

        <div class="loginField">
            <label>Pilih Role</label>
            <select id="roleSelect">
                <option value="Admin">Admin</option>
                <option value="Supervisor">Supervisor</option>
                <option value="Operator">Operator</option>
                <option value="Viewer">Viewer</option>
            </select>
        </div>

        <div class="loginField">
            <label>Password</label>
            <input type="password" id="passwordInput" placeholder="Masukkan Password">
        </div>

        <button class="btnLogin" onclick="doLogin()">Masuk Sekarang</button>

        <div id="loginError"></div>
    </div>
</div>



<div id="app" class="hidden">

    <header>
        <div class="headerWrap">
            <h2>KMS UMKM Susu Segar</h2>
            <span id="roleBadge"></span>
        </div>
    </header>


    <div id="appContainer">

        <aside class="sidebar">
            <nav id="sidebarNav">
                <a data-section="home" class="active" onclick="showSection(event)">Beranda</a>
                <a data-section="sop" onclick="showSection(event)">SOP Pengolahan</a>
                <a data-section="kualitas" onclick="showSection(event)">Pemeriksaan Kualitas</a>
                <a data-section="sanitasi" onclick="showSection(event)">Kebersihan & Sanitasi</a>
                <a data-section="pemasok" onclick="showSection(event)">Data Pemasok</a>
                <a data-section="produk" onclick="showSection(event)">Produk</a>
                <a data-section="pelatihan" onclick="showSection(event)">Pelatihan</a>

                <a id="menu-admin" data-section="adminPanel" onclick="showSection(event)" style="color:#d62828; font-weight:700; display:none;">
                    âš™ Kelola Sistem (ADMIN)
                </a>

            </nav>

            <button id="logoutBtn" onclick="logout()">Logout</button>
        </aside>



        <main>

            <section id="home" class="card section">
                <h2>Beranda</h2>
                <p>Selamat datang di KMS UMKM Susu Segar. Sistem ini berisi dokumentasi SOP, Sanitasi, Kualitas, Supplier, Produk, dan Pelatihan.</p>
                
                <hr style="margin: 20px 0;">
                
                <h3>ðŸ¥¤ Varian Menu UMKM Susu Segar</h3>
                
                <h4 style="margin-top: 15px; color: var(--accent);">Pilihan Ice/Hot</h4>
                <div class="menu-grid">
                    <div class="menu-item">
                        <img src="sugarori.jpg" alt="Original">
                        <h4>Original</h4>
                        <small>Ice / Hot</small>
                    </div>
                    <div class="menu-item">
                        <img src="sugarcok.jpg" alt="Coklat">
                        <h4>Coklat</h4>
                        <small>Ice / Hot</small>
                    </div>
                    <div class="menu-item">
                        <img src="sugarstraw.jpg" alt="Strawberry">
                        <h4>Strawberry</h4>
                        <small>Ice / Hot</small>
                    </div>
                    <div class="menu-item">
                        <img src="sugarmilo.jpg" alt="Milo">
                        <h4>Milo</h4>
                        <small>Ice / Hot</small>
                    </div>
                    <div class="menu-item">
                        <img src="sugarbengbeng.jpg" alt="Beng-Beng">
                        <h4>Beng-Beng</h4>
                        <small>Ice / Hot</small>
                    </div>
                    <div class="menu-item">
                        <img src="sugartaro.jpg" alt="Taro">
                        <h4>Taro</h4>
                        <small>Ice / Hot</small>
                    </div>
                    <div class="menu-item">
                        <img src="sugargreen.jpg" alt="Green Tea">
                        <h4>Green Tea</h4>
                        <small>Ice / Hot</small>
                    </div>
                </div>

                <h4 style="margin-top: 25px; color: var(--accent);">Pilihan Blender</h4>
                <div class="menu-grid">
                    <div class="menu-item">
                        <img src="blendoreo.jpg" alt="Choco Oreo">
                        <h4>Choco Oreo</h4>
                        <small>Blender</small>
                    </div>
                    <div class="menu-item">
                        <img src="blendblue.jpg" alt="Vanilla Blue">
                        <h4>Vanilla Blue</h4>
                        <small>Blender</small>
                    </div>
                    <div class="menu-item">
                        <img src="blenddurian.jpg" alt="Durian">
                        <h4>Durian</h4>
                        <small>Blender</small>
                    </div>
                    <div class="menu-item">
                        <img src="blendmango.jpg" alt="Mangga">
                        <h4>Mangga</h4>
                        <small>Blender</small>
                    </div>
                </div>

            </section>




            <section id="sop" class="card section hidden">
                <h2>SOP Pengolahan</h2>

                <div id="sopList"></div>
            </section>




            <section id="kualitas" class="card section hidden">
                <h2>Pemeriksaan Kualitas</h2>
                <ul>
                    <li>Suhu ideal â‰¤ 4Â°C</li>
                    <li>Bau segar, tidak asam</li>
                    <li>Warna putih bersih</li>
                </ul>
            </section>




            <section id="sanitasi" class="card section hidden">
                <h2>Kebersihan & Sanitasi</h2>
                <ul>
                    <li>Sterilisasi alat pagi hari</li>
                    <li>Disinfektan antar shift</li>
                    <li>Deep cleaning akhir hari</li>
                </ul>
            </section>



            <section id="pemasok" class="card section hidden">
                <h2>Data Pemasok</h2>
                <table border="1" width="100%" cellpadding="6">
                    <thead>
                        <tr><th>Nama</th><th>Lokasi</th><th>Kontak</th>
                        <th id="supplierActionHeader" style="display:none;">Aksi</th></tr>
                    </thead>
                    <tbody id="supplierList"></tbody>
                </table>
            </section>




            <section id="produk" class="card section hidden">
                <h2>Produk UMKM</h2>

                <div id="productList" style="display:grid; grid-template-columns:repeat(2,1fr); gap:10px;"></div>

            </section>



            <section id="pelatihan" class="card section hidden">
                <h2>Pelatihan Karyawan</h2>
                <ul id="trainingList"></ul>
            </section>




            <section id="adminPanel" class="card section hidden">

                <h2>âš™ Panel Admin</h2>
                <p>Kelola konten sistem KMS secara langsung.</p>


                <div class="adminBox">
                    <h3>Kelola SOP</h3>
                    <input id="newSopTitle" class="adminInput" placeholder="Judul SOP">
                    <textarea id="newSopContent" class="adminInput" placeholder="Isi SOP (tiap langkah dipisah baris)"></textarea>
                    <button class="adminBtn" onclick="addSOP()">Tambahkan SOP</button>
                </div>

                <div class="adminBox">
                    <h3>Kelola Supplier</h3>
                    <input id="supName" class="adminInput" placeholder="Nama Supplier">
                    <input id="supLoc" class="adminInput" placeholder="Lokasi">
                    <input id="supContact" class="adminInput" placeholder="Kontak">
                    <button class="adminBtn" onclick="addSupplier()">Tambah Supplier</button>
                </div>

                <div class="adminBox">
                    <h3>Kelola Produk</h3>
                    <input id="prodName" class="adminInput" placeholder="Nama Produk">
                    <button class="adminBtn" onclick="addProduct()">Tambah Produk</button>
                </div>

                <div class="adminBox">
                    <h3>Kelola Materi Pelatihan</h3>
                    <input id="trainName" class="adminInput" placeholder="Nama Materi">
                    <button class="adminBtn" onclick="addTraining()">Tambah Materi</button>
                </div>

            </section>



        </main>
    </div>
</div>

<script>
/* ===========================
    KMS â€” Role Access + Admin CRUD
=========================== */

/* ----- password per role ----- */
const rolePasswords = {
    admin: "admin123",
    supervisor: "sup123",
    operator: "op123",
    viewer: "view123"
};

/* ----- storage keys ----- */
const SOPS_KEY = "kms_sops_v1";
const SUPP_KEY = "kms_suppliers_v1";
const PROD_KEY = "kms_products_v1";
const TRAIN_KEY = "kms_trainings_v1";

/* ----- default data ----- */
const DEFAULT_SOPS = [
    { id: "receive", title: "SOP Penerimaan Susu", content: "Periksa dokumen pemasok\nCek bau, warna, rasa\nCatat suhu (â‰¤6Â°C)\nInput data ke sistem" },
    { id: "filter", title: "SOP Penyaringan", content: "Gunakan saringan steril\nBersihkan alat sebelum proses\nGunakan sarung tangan" },
    { id: "pack", title: "SOP Pengemasan", content: "Sterilisasi botol\nIsi & segel\nBeri label batch" }
];

const DEFAULT_SUPPLIERS = [
    { id: generateId("sup"), name: "Peternak Sari", location: "Desa A", contact: "0812-xxx" },
    { id: generateId("sup"), name: "Kelompok Makmur", location: "Kec. B", contact: "0821-yyy" }
];

const DEFAULT_PRODUCTS = [
    { id: generateId("prod"), name: "Susu Segar 500ml" },
    { id: generateId("prod"), name: "Susu 250ml Botol" },
    { id: generateId("prod"), name: "Yoghurt Lokal" }
];

const DEFAULT_TRAIN = [
    { id: generateId("trn"), name: "Modul 1 â€” Penanganan Susu Aman" },
    { id: generateId("trn"), name: "Modul 2 â€” Kebersihan & Sanitasi" }
];

/* ---------------------- */
function generateId(prefix="id"){ return prefix + "_" + Math.random().toString(36).slice(2,9); }
function save(k,d){ localStorage.setItem(k,JSON.stringify(d)); }
function load(k,fallback){
    const v = localStorage.getItem(k);
    if (!v){
        if (fallback){ save(k,fallback); return JSON.parse(JSON.stringify(fallback)); }
        return [];
    }
    try { return JSON.parse(v); } catch { return []; }
}

function ensureDefaults(){
    if(!localStorage.getItem(SOPS_KEY)) save(SOPS_KEY, DEFAULT_SOPS);
    if(!localStorage.getItem(SUPP_KEY)) save(SUPP_KEY, DEFAULT_SUPPLIERS);
    if(!localStorage.getItem(PROD_KEY)) save(PROD_KEY, DEFAULT_PRODUCTS);
    if(!localStorage.getItem(TRAIN_KEY)) save(TRAIN_KEY, DEFAULT_TRAIN);
}

/* ----------------------
     LOGIN SYSTEM
---------------------- */
function doLogin(){
    const role = document.getElementById("roleSelect").value.toLowerCase();
    const pw = document.getElementById("passwordInput").value;
    const err = document.getElementById("loginError");

    err.textContent = "";

    if (!role || !pw){
        err.textContent = "Pilih role dan masukkan password.";
        return;
    }
    if (!rolePasswords[role]){
        err.textContent = "Role tidak dikenali.";
        return;
    }
    if (pw !== rolePasswords[role]){
        err.textContent = "Password salah.";
        return;
    }

    localStorage.setItem("kms_role", role);
    document.getElementById("loginPage").style.display = "none";
    document.getElementById("app").classList.remove("hidden");

    setupRoleUI();
}

function logout(){
    localStorage.removeItem("kms_role");
    location.reload();
}

/* ----------------------
     ROLE UI CONFIG
---------------------- */
function setupRoleUI(){
    ensureDefaults();

    const role = localStorage.getItem("kms_role");
    if (!role) return;

    const badge = document.getElementById("roleBadge");
    badge.style.display="inline-block";
    badge.textContent = role.toUpperCase();

    const adminLink = document.getElementById("menu-admin");
    adminLink.style.display = role==="admin" ? "block":"none";

    const hAksi = document.getElementById("supplierActionHeader");
    hAksi.style.display = role==="admin" ? "table-cell":"none";

    const navs = {
        home:"home", sop:"sop", kualitas:"kualitas",
        sanitasi:"sanitasi", pemasok:"pemasok",
        produk:"produk", pelatihan:"pelatihan",
        adminPanel:"adminPanel"
    };

    document.querySelectorAll(".sidebar nav a").forEach(a=>a.style.display="none");

    if(role==="admin"){
        Object.values(navs).forEach(k=>
            document.querySelector(`a[data-section="${k}"]`).style.display="block"
        );
    } else if(role==="supervisor"){
        ["home","sop","kualitas","sanitasi","pemasok","produk"]
        .forEach(k=>document.querySelector(`a[data-section="${k}"]`).style.display="block");
    } else if(role==="operator"){
        ["home","sop","kualitas","produk","sanitasi"]
        .forEach(k=>document.querySelector(`a[data-section="${k}"]`).style.display="block");
    } else if(role==="viewer"){
        ["home","sop","pelatihan"]
        .forEach(k=>document.querySelector(`a[data-section="${k}"]`).style.display="block");
    }

    renderAll();

    const homeLink = document.querySelector('a[data-section="home"]');
    homeLink.classList.add("active");
    showSection({currentTarget:homeLink, preventDefault(){}});
}

/* ----------------------
     RENDER FUNCTIONS
---------------------- */
function renderAll(){
    renderSOPs();
    renderSuppliers();
    renderProducts();
    renderTrainings();
}

/* ============================================================
      INLINE EDITOR SOP â€” NEW SYSTEM
============================================================ */
function renderSOPs(){
    const sops = load(SOPS_KEY, DEFAULT_SOPS);
    const wrap = document.getElementById("sopList");
    const role = localStorage.getItem("kms_role");
    wrap.innerHTML = "";

    sops.forEach(s => {
        const card = document.createElement("div");
        card.className = "card sopItem";
        card.id = "sop_card_" + s.id;

        /* MODE NORMAL (TAMPIL SOP) */
        const htmlNormal = `
            <h3 onclick="toggleDetail('${s.id}')" style="cursor:pointer">
                ${s.title}
            </h3>
            <div id="sop_detail_${s.id}" class="sopDetail" style="display:none;">
                <ol>${ s.content.split("\n").map(c=>`<li>${c}</li>`).join("") }</ol>
            </div>
        `;

        /* MODE ADMIN (TOMBOL EDIT/HAPUS) */
        let adminCtrl = "";
        if(role==="admin"){
            adminCtrl = `
                <div style="margin-top:10px;">
                    <button class="adminBtn" onclick="enterEditSOP('${s.id}')">Edit</button>
                    <button class="adminBtn" style="background:#d62828;" onclick="removeSOP('${s.id}')">Hapus</button>
                </div>
            `;
        }

        card.innerHTML = htmlNormal + adminCtrl;
        wrap.appendChild(card);
    });

    if(sops.length===0){
        wrap.innerHTML = "<div class='card'>Belum ada SOP.</div>";
    }
}

/* Expand/Collapse */
function toggleDetail(id){
    const el = document.getElementById("sop_detail_"+id);
    if(!el) return;
    el.style.display = el.style.display==="block" ? "none" : "block";
}

/* ---------------------------
      ENTER EDIT MODE
--------------------------- */
function enterEditSOP(id){
    const sops = load(SOPS_KEY, DEFAULT_SOPS);
    const sop = sops.find(x=>x.id===id);
    if(!sop) return;

    const card = document.getElementById("sop_card_"+id);

    card.innerHTML = `
        <h3>Edit SOP</h3>

        <label>Judul:</label>
        <input type="text" id="edit_title_${id}" class="adminInput" value="${sop.title}">

        <label>Isi SOP:</label>
        <textarea id="edit_content_${id}" class="adminInput" style="min-height:140px;">${sop.content}</textarea>

        <button class="adminBtn" onclick="saveEditSOP('${id}')">Simpan</button>
        <button class="adminBtn" style="background:#6b7280;" onclick="renderSOPs()">Batal</button>
    `;
}

/* ---------------------------
      SAVE EDIT SOP
--------------------------- */
function saveEditSOP(id){
    const newTitle = document.getElementById("edit_title_"+id).value.trim();
    const newContent = document.getElementById("edit_content_"+id).value.trim();

    if(!newTitle || !newContent){
        alert("Judul dan isi SOP wajib diisi.");
        return;
    }

    let sops = load(SOPS_KEY, DEFAULT_SOPS);
    const idx = sops.findIndex(x=>x.id===id);
    if(idx !== -1){
        sops[idx].title = newTitle;
        sops[idx].content = newContent;
        save(SOPS_KEY, sops);
    }

    renderSOPs();
    alert("SOP berhasil diperbarui.");
}

/* ---------------------------
      DELETE SOP
--------------------------- */
function removeSOP(id){
    if(!confirm("Hapus SOP ini?")) return;
    let sops = load(SOPS_KEY, DEFAULT_SOPS).filter(x=>x.id!==id);
    save(SOPS_KEY, sops);
    renderSOPs();
    alert("SOP dihapus.");
}

/* ============================================================
     SUPPLIERS / PRODUCTS / TRAININGS (TANPA PERUBAHAN)
============================================================ */

function renderSuppliers(){
    const arr = load(SUPP_KEY, DEFAULT_SUPPLIERS);
    const tbody = document.getElementById("supplierList");
    const role = localStorage.getItem("kms_role");
    tbody.innerHTML = "";

    arr.forEach(s=>{
        const tr=document.createElement("tr");
        tr.innerHTML = `<td>${s.name}</td><td>${s.location}</td><td>${s.contact}</td>`;

        if(role==="admin"){
            const td=document.createElement("td");
            const b=document.createElement("button");
            b.className="adminBtn";
            b.textContent="Hapus";
            b.style.background="#d62828";
            b.onclick=()=>removeSupplier(s.id);
            td.appendChild(b);
            tr.appendChild(td);
        }
        tbody.appendChild(tr);
    });

    if(arr.length===0){
        tbody.innerHTML = "<tr><td colspan='4'>Belum ada pemasok.</td></tr>";
    }
}

function addSupplier(){
    const name=document.getElementById("supName").value.trim();
    const loc=document.getElementById("supLoc").value.trim();
    const c=document.getElementById("supContact").value.trim();
    if(!name){ alert("Nama wajib."); return; }

    let arr=load(SUPP_KEY, DEFAULT_SUPPLIERS);
    arr.push({ id:generateId("sup"), name, location:loc||"-", contact:c||"-" });
    save(SUPP_KEY,arr);

    document.getElementById("supName").value="";
    document.getElementById("supLoc").value="";
    document.getElementById("supContact").value="";
    renderSuppliers();
}

function removeSupplier(id){
    if(!confirm("Hapus pemasok?")) return;
    let arr=load(SUPP_KEY, DEFAULT_SUPPLIERS).filter(x=>x.id!==id);
    save(SUPP_KEY,arr);
    renderSuppliers();
}

function renderProducts(){
    const arr=load(PROD_KEY, DEFAULT_PRODUCTS);
    const cont=document.getElementById("productList");
    const role=localStorage.getItem("kms_role");
    cont.innerHTML="";

    arr.forEach(p=>{
        const card=document.createElement("div");
        card.className="productCard card";
        card.innerHTML=`<h4>${p.name}</h4>`;

        if(role==="admin"){
            const b=document.createElement("button");
            b.className="adminBtn";
            b.style.background="#d62828";
            b.textContent="Hapus";
            b.onclick=()=>removeProduct(p.id);
            card.appendChild(b);
        }
        cont.appendChild(card);
    });

    if(arr.length===0){
        cont.innerHTML="<div class='card'>Belum ada produk.</div>";
    }
}

function addProduct(){
    const name=document.getElementById("prodName").value.trim();
    if(!name){ alert("Nama wajib."); return; }
    let arr=load(PROD_KEY, DEFAULT_PRODUCTS);
    arr.push({id:generateId("prod"), name});
    save(PROD_KEY,arr);
    document.getElementById("prodName").value="";
    renderProducts();
}

function removeProduct(id){
    if(!confirm("Hapus produk?")) return;
    let arr=load(PROD_KEY, DEFAULT_PRODUCTS).filter(x=>x.id!==id);
    save(PROD_KEY,arr);
    renderProducts();
}

function renderTrainings(){
    const arr=load(TRAIN_KEY, DEFAULT_TRAIN);
    const list=document.getElementById("trainingList");
    const role=localStorage.getItem("kms_role");
    list.innerHTML="";

    arr.forEach(t=>{
        const li=document.createElement("li");
        li.textContent=t.name;

        if(role==="admin"){
            const b=document.createElement("button");
            b.className="adminBtn";
            b.style.marginLeft="8px";
            b.style.background="#d62828";
            b.textContent="Hapus";
            b.onclick=()=>removeTraining(t.id);
            li.appendChild(b);
        }
        list.appendChild(li);
    });

    if(arr.length===0){
        list.innerHTML="<li>Belum ada materi pelatihan.</li>";
    }
}

function addTraining(){
    const n=document.getElementById("trainName").value.trim();
    if(!n){ alert("Nama wajib."); return; }
    let arr=load(TRAIN_KEY, DEFAULT_TRAIN);
    arr.push({id:generateId("trn"), name:n});
    save(TRAIN_KEY,arr);
    document.getElementById("trainName").value="";
    renderTrainings();
}

function removeTraining(id){
    if(!confirm("Hapus materi?")) return;
    let arr=load(TRAIN_KEY, DEFAULT_TRAIN).filter(x=>x.id!==id);
    save(TRAIN_KEY,arr);
    renderTrainings();
}

/* ---------------------------
      NAVIGATION
--------------------------- */
function showSection(e){
    const sec = e.currentTarget.dataset.section;
    document.querySelectorAll(".section").forEach(s=>s.classList.add("hidden"));
    document.getElementById(sec).classList.remove("hidden");

    document.querySelectorAll(".sidebar nav a").forEach(a=>a.classList.remove("active"));
    e.currentTarget.classList.add("active");
}

/* ---------------------------
     PAGE LOAD INIT
--------------------------- */
document.addEventListener("DOMContentLoaded",()=>{
    ensureDefaults();

    const role=localStorage.getItem("kms_role");
    if(role){
        document.getElementById("loginPage").style.display="none";
        document.getElementById("app").classList.remove("hidden");
        setupRoleUI();
    }

    document.getElementById("passwordInput")
        .addEventListener("keyup",e=>{ if(e.key==="Enter") doLogin(); });
});
</script>
