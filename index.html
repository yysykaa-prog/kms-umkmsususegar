<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KMS UMKM Susu Segar — FINAL FIX</title>

<style>
/* =======================================================
   GLOBAL & RESET
======================================================= */
:root{
  --accent:#1f6feb;
  --muted:#6b7280;
  --bg:#f5f6fa;
  --white:#ffffff;
  --radius:10px;
  --maxw:1100px;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family: system-ui, Arial, sans-serif;
  background:var(--bg);
  color:#111;
  line-height:1.45;
}

/* =======================================================
   LOGIN PAGE
======================================================= */
#loginPage{
  max-width:380px;
  margin:70px auto;
  background:var(--white);
  padding:24px;
  border-radius:var(--radius);
  box-shadow:0 4px 14px rgba(0,0,0,0.07);
}
#loginPage h2{
  margin-bottom:14px;
  text-align:center;
}
.loginField{
  margin-bottom:14px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.loginField select,
.loginField input{
  padding:10px 12px;
  border-radius:8px;
  border:1px solid #d1d5db;
}
.btnLogin{
  width:100%;
  padding:10px;
  background:var(--accent);
  color:white;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}
#loginError{
  margin-top:10px;
  color:#d00;
  text-align:center;
  font-size:14px;
}

/* =======================================================
   HEADER
======================================================= */
header{
  background:linear-gradient(90deg,var(--accent),#0b7cd1);
  color:white;
  padding:18px 0;
  box-shadow:0 3px 10px rgba(0,0,0,0.1);
}
.wrapHeader{
  max-width:var(--maxw);
  margin:auto;
  padding:0 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
#roleBadge{
  display:none;
  background:white;
  color:var(--accent);
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
}

/* =======================================================
   LAYOUT GRID
======================================================= */
.appWrap{
  max-width:var(--maxw);
  margin:20px auto;
  padding:0 16px;
  display:grid;
  grid-template-columns:250px 1fr;
  gap:18px;
}
@media (max-width:850px){
  .appWrap{grid-template-columns:1fr;}
}

/* =======================================================
   SIDEBAR
======================================================= */
.sidebar{
  background:white;
  padding:16px;
  border-radius:var(--radius);
  box-shadow:0 4px 12px rgba(0,0,0,0.06);
  height:fit-content;
}
.sidebar nav{
  margin-top:10px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.sidebar nav a{
  padding:8px 10px;
  border-radius:6px;
  cursor:pointer;
  text-decoration:none;
  color:#1f6feb;
  font-weight:600;
}
.sidebar nav a.active{
  background:#e7f0ff;
}

/* =======================================================
   CONTENT
======================================================= */
.card{
  background:white;
  padding:18px;
  border-radius:var(--radius);
  box-shadow:0 4px 12px rgba(0,0,0,0.05);
  margin-bottom:16px;
}
.hidden{display:none;}

.sopItem h3{
  cursor:pointer;
  color:#1f6feb;
  margin-bottom:6px;
}
.sopDetail{
  padding-left:16px;
  margin-top:6px;
  display:none;
}

/* Logout Button */
#logoutBtn{
  margin-top:14px;
  display:inline-block;
  padding:8px 12px;
  border-radius:8px;
  border:1px solid #d1d5db;
  background:#fafafa;
  cursor:pointer;
  color:#444;
}
</style>
</head>

<body>

<!-- ======================================================
     HALAMAN LOGIN
====================================================== -->
<div id="loginPage">
    <h2>Login KMS</h2>

    <div class="loginField">
        <label>Pilih Role</label>
        <select id="roleSelect">
            <option value="admin">Admin</option>
            <option value="supervisor">Supervisor</option>
            <option value="operator">Operator</option>
            <option value="viewer">Viewer</option>
        </select>
    </div>

    <div class="loginField">
        <label>Password</label>
        <input type="password" id="passwordInput" placeholder="Masukkan password..." />
    </div>

    <button class="btnLogin" onclick="doLogin()">Login</button>

    <div id="loginError"></div>
</div>



<!-- ======================================================
     APP KMS
====================================================== -->
<div id="app" style="display:none;">

<header>
    <div class="wrapHeader">
        <h2>KMS UMKM Susu Segar</h2>
        <span id="roleBadge">ROLE: <strong id="roleDisplay"></strong></span>
    </div>
</header>

<div class="appWrap">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <nav id="sidebarMenu">
            <a data-section="home" onclick="showSection(event)" class="active">Beranda</a>
            <a data-section="sop" onclick="showSection(event)">SOP Pengolahan</a>
            <a data-section="kualitas" onclick="showSection(event)">Pemeriksaan Kualitas</a>
            <a data-section="sanitasi" onclick="showSection(event)">Kebersihan & Sanitasi</a>
            <a data-section="pemasok" onclick="showSection(event)">Data Pemasok</a>
            <a data-section="produk" onclick="showSection(event)">Produk</a>
            <a data-section="pelatihan" onclick="showSection(event)">Pelatihan</a>
        </nav>

        <button id="logoutBtn" onclick="logoutUser()">Logout</button>
    </aside>


    <!-- ======================================================
         HALAMAN UTAMA KMS
    ====================================================== -->
    <main>

        <!-- BERANDA -->
        <section id="home" class="card section">
            <h2>Beranda</h2>
            <p>Selamat datang di sistem KMS UMKM Susu Segar.</p>
        </section>

        <!-- SOP -->
        <section id="sop" class="card section hidden">
            <h2>SOP Pengolahan</h2>

            <div class="card sopItem">
                <h3 onclick="toggleSOP('receive')">SOP Penerimaan Susu</h3>
                <div id="sop-receive" class="sopDetail">
                    <ol>
                        <li>Periksa dokumen pemasok</li>
                        <li>Cek bau, warna, rasa</li>
                        <li>Catat suhu (≤6°C)</li>
                        <li>Input data ke sistem</li>
                    </ol>
                </div>
            </div>

            <div class="card sopItem">
                <h3 onclick="toggleSOP('filter')">SOP Penyaringan</h3>
                <div id="sop-filter" class="sopDetail">
                    <ol>
                        <li>Gunakan saringan steril</li>
                        <li>Bersihkan alat sebelum proses</li>
                        <li>Gunakan sarung tangan</li>
                    </ol>
                </div>
            </div>

            <div class="card sopItem">
                <h3 onclick="toggleSOP('pack')">SOP Pengemasan</h3>
                <div id="sop-pack" class="sopDetail">
                    <ol>
                        <li>Sterilisasi botol</li>
                        <li>Isi & segel</li>
                        <li>Beri label batch</li>
                    </ol>
                </div>
            </div>
        </section>

        <!-- KUALITAS -->
        <section id="kualitas" class="card section hidden">
            <h2>Pemeriksaan Kualitas</h2>
            <ul>
                <li>Suhu ≤ 4°C</li>
                <li>Bau normal</li>
                <li>Warna putih bersih</li>
            </ul>
        </section>

        <!-- SANITASI -->
        <section id="sanitasi" class="card section hidden">
            <h2>Kebersihan & Sanitasi</h2>
            <ul>
                <li>Sterilisasi pagi</li>
                <li>Disinfektan antar shift</li>
                <li>Deep cleaning akhir hari</li>
            </ul>
        </section>

        <!-- PEMASOK -->
        <section id="pemasok" class="card section hidden">
            <h2>Data Pemasok</h2>
            <table>
                <tr><th>Nama</th><th>Lokasi</th><th>Kontak</th></tr>
                <tr><td>Peternak Sari</td><td>Desa A</td><td>0812-xxx</td></tr>
                <tr><td>Kelompok Makmur</td><td>Kec. B</td><td>0821-yyy</td></tr>
            </table>
        </section>

        <!-- PRODUK -->
        <section id="produk" class="card section hidden">
            <h2>Produk</h2>
            <ul>
                <li>Susu Segar 500ml</li>
                <li>Susu Botol 250ml</li>
                <li>Yoghurt</li>
            </ul>
        </section>

        <!-- PELATIHAN -->
        <section id="pelatihan" class="card section hidden">
            <h2>Pelatihan Karyawan</h2>
            <ol>
                <li>Pemahaman susu aman</li>
                <li>Cek kualitas harian</li>
                <li>Kebersihan diri</li>
            </ol>
        </section>

    </main>
</div>
</div>

<script>
/* ======================================================
   LOGIN + ROLE ACCESS
====================================================== */

const rolePasswords = {
    admin: "admin123",
    supervisor: "sup123",
    operator: "op123",
    viewer: "view123"
};

function doLogin(){
    const role = document.getElementById("roleSelect").value;
    const pw = document.getElementById("passwordInput").value;
    const err = document.getElementById("loginError");

    if (!pw){
        err.textContent = "Password tidak boleh kosong.";
        return;
    }
    if (pw !== rolePasswords[role]){
        err.textContent = "Password salah.";
        return;
    }

    // Simpan login
    localStorage.setItem("kms_role", role);

    // Tampilkan app
    document.getElementById("loginPage").style.display = "none";
    document.getElementById("app").style.display = "block";

    setupRoleUI();
}

function logoutUser(){
    localStorage.removeItem("kms_role");
    location.reload();
}

/* ======================================================
   ATUR MENU BERDASARKAN ROLE
====================================================== */
function setupRoleUI(){
    const role = localStorage.getItem("kms_role");
    if (!role) return;

    document.getElementById("roleDisplay").textContent = role.toUpperCase();
    document.getElementById("roleBadge").style.display = "inline-block";

    const menu = {
        home: document.querySelector('[data-section="home"]'),
        sop: document.querySelector('[data-section="sop"]'),
        kualitas: document.querySelector('[data-section="kualitas"]'),
        sanitasi: document.querySelector('[data-section="sanitasi"]'),
        pemasok: document.querySelector('[data-section="pemasok"]'),
        produk: document.querySelector('[data-section="produk"]'),
        pelatihan: document.querySelector('[data-section="pelatihan"]')
    };

    // Semua hidden dulu
    Object.values(menu).forEach(m => m.style.display = "none");

    if (role === "admin"){
        Object.values(menu).forEach(m => m.style.display = "block");
    }
    if (role === "supervisor"){
        menu.home.style.display = "block";
        menu.sop.style.display = "block";
        menu.kualitas.style.display = "block";
        menu.sanitasi.style.display = "block";
        menu.pemasok.style.display = "block";
    }
    if (role === "operator"){
        menu.home.style.display = "block";
        menu.sop.style.display = "block";
        menu.kualitas.style.display = "block";
        menu.produk.style.display = "block";
    }
    if (role === "viewer"){
        menu.home.style.display = "block";
    }

    showSection({preventDefault(){}, currentTarget: menu.home});
}

/* ======================================================
   NAVIGASI
====================================================== */
function showSection(e){
    e.preventDefault();
    const link = e.currentTarget;
    const section = link.dataset.section;

    document.querySelectorAll(".section").forEach(s => s.classList.add("hidden"));
    document.getElementById(section).classList.remove("hidden");

    document.querySelectorAll(".sidebar nav a").forEach(a => a.classList.remove("active"));
    link.classList.add("active");
}

/* ======================================================
   SOP COLLAPSIBLE
====================================================== */
function toggleSOP(key){
    const el = document.getElementById("sop-" + key);
    el.style.display = el.style.display === "block" ? "none" : "block";
}

/* ======================================================
   LOAD STATE
====================================================== */
document.addEventListener("DOMContentLoaded", ()=>{
    const role = localStorage.getItem("kms_role");

    if (role){
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("app").style.display = "block";
        setupRoleUI();
    }
});
</script>

</body>
</html>
